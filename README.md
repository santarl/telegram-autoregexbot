# Telegram AutoRegex Bot

A Telegram bot that performs configurable regex-based message substitutions using sed/perl-like syntax. Originally designed to fix social media embeds (like changing Twitter links to fxtwitter) and strip tracking parameters from URLs.

## Features

*   **Regex Substitutions:** Supports `s@pattern@replacement@flags` syntax.
*   **Tracking Removal:** Automatically strips common tracking parameters (`utm_`, `si`, `igsh`, etc.) from URLs.
*   **Flexible Processing:** Can process the entire message or just extract and transform URLs (default).
*   **Reminders:** In-house `/remindme` command with human-readable time parsing (e.g., `2h`, `30m`).
*   **Access Control:** Robust whitelist/blacklist policy for chats and users.
*   **Hot Reload:** Configuration changes are applied instantly without restarting the bot.
*   **Docker Ready:** Multi-arch support (amd64, arm64) with distroless base image for security.

## Commands

*   `/remindme <time> (reason)` - Sets a reminder. Example: `/remindme 2h (check laundry)`
*   `/version` - Shows the current bot version (CalVer) and commit SHA.

## Installation

### Method 1: Docker (Recommended)

1.  **Clone the repository:**
    ```bash
    git clone https://github.com/santarl/telegram-autoregexbot.git
    cd telegram-autoregexbot
    ```

2.  **Configuration:**
    *   Copy `secrets.cfg.example` to `secrets.cfg` and add your `BOT_TOKEN`.
    *   (Optional) Create `autoregexbot.cfg` to override defaults in `autoregexbot.cfg.example`.

3.  **Run with Docker Compose:**
    ```bash
    docker-compose up -d
    ```

### Method 2: Local Installation (using uv)

1.  **Install [uv](https://github.com/astral-sh/uv).**
2.  **Sync dependencies:**
    ```bash
    uv sync
    ```
3.  **Run the bot:**
    ```bash
    uv run python -m telegram_autoregexbot.autoregex
    ```

## Configuration

The bot uses a fallback configuration system:
1.  **`autoregexbot.cfg.example`**: Contains all default rules and settings. **Do not edit this file directly.**
2.  **`autoregexbot.cfg`**: Create this file to add your own rules or override settings. It is ignored by git.

### Example Substitution Rule
```ini
[substitutions]
# Fix Twitter links
fix_twitter = s@https?://(?:www\.)?(?:twitter|x)\.com/([^ \n]+)@https://fxtwitter.com/\1@i
```

## License

MIT
